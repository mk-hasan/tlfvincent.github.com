---
layout:     post
title: "Flow and Dynamics in NBA games - Part II"
subtitle:   "A look from 2001 to now"
date:       2015-06-12
author:     "Thomas Vincent"
header-img: "img/galaxy.jpg"
---

<style type="text/css">
/*body{font-family: Arial, sans-serif;font-size:10px;}*/
  .axis path,.axis line {
    fill: none;
    stroke:#b6b6b6;
    shape-rendering: crispEdges;
  }
  /*.tick line{fill:none;stroke:none;}*/
  .tick text{
    fill:#999;
    font-size:14px;
  }

  g.journal.active{
    cursor:pointer;
  }

  text.label{
    font-size:12px;
    font-weight:bold;
    cursor:pointer;
  }

  text.value{
    font-size:12px;
    font-weight:bold;
  }
</style>


<p align="justify">
In part I of this post series on NBA game dynamics, I explored the average score differential that teams faced over the course of games. Interestingly, this proved to not be a very relaible proxy foras a for overall performance and number of wins accrued over an entire season. I began by looking at the average score differential that teams achieved when playing at home, and then when playing away. The two charts below show the clear benefits of playing on your home-court.
</p>

<center>
  <h4> Time spent in the lead for teams playing away</h4>
  <div id="home_lead_prop" style="text-align:left"> </div>
</center>


<script src="http://d3js.org/d3.v3.min.js"></script>


<script>

var data = 
{
 "Atlanta": [
 {
 "2001":     53,
"2002": 50.415,
"2003": 61.244,
"2004":     57,
"2005": 37.634,
"2006": 50.854,
"2007": 52.634,
"2008": 58.244,
"2009": 58.341,
"2010": 71.439,
"2011": 53.073,
"2012":  66.97,
"2013": 56.585,
"2014": 54.341 
} 
],
"Boston": [
 {
 "2001": 51.659,
"2002": 66.073,
"2003":  66.22,
"2004": 52.976,
"2005": 61.659,
"2006": 57.683,
"2007": 47.244,
"2008": 83.366,
"2009":  71.61,
"2010": 67.829,
"2011": 72.341,
"2012": 68.788,
"2013": 69.875,
"2014": 53.805 
} 
],
"Brooklyn": [
 {
 "2001":      0,
"2002":      0,
"2003":      0,
"2004":      0,
"2005":      0,
"2006":      0,
"2007":      0,
"2008":      0,
"2009":      0,
"2010":      0,
"2011":      0,
"2012":      0,
"2013": 66.171,
"2014": 67.707 
} 
],
"Charlotte": [
 {
 "2001":     60,
"2002": 56.634,
"2003":      0,
"2004":      0,
"2005": 48.049,
"2006": 43.634,
"2007": 56.195,
"2008": 50.976,
"2009": 60.293,
"2010":  62.61,
"2011": 56.683,
"2012": 26.091,
"2013": 39.707,
"2014": 65.585 
} 
],
"Chicago": [
 {
 "2001": 43.439,
"2002":  33.61,
"2003":  61.61,
"2004":  49.22,
"2005": 67.634,
"2006": 52.683,
"2007": 75.659,
"2008": 58.463,
"2009": 56.512,
"2010": 52.049,
"2011": 73.366,
"2012": 69.515,
"2013": 55.049,
"2014": 64.122 
} 
],
"Cleveland": [
 {
 "2001": 51.512,
"2002":  49.61,
"2003": 40.488,
"2004": 55.073,
"2005":     70,
"2006": 65.927,
"2007": 68.293,
"2008": 61.268,
"2009": 83.488,
"2010":  75.61,
"2011": 38.146,
"2012": 32.121,
"2013":     47,
"2014": 56.878 
} 
],
"Dallas": [
 {
 "2001": 64.585,
"2002": 64.049,
"2003":  75.61,
"2004": 74.244,
"2005": 68.634,
"2006":  75.22,
"2007": 77.805,
"2008": 76.683,
"2009": 64.659,
"2010": 58.732,
"2011": 66.805,
"2012": 66.485,
"2013": 55.585,
"2014": 64.293 
} 
],
"Denver": [
 {
 "2001": 65.244,
"2002":  44.78,
"2003":     41,
"2004": 69.146,
"2005": 68.976,
"2006": 63.683,
"2007": 65.171,
"2008": 69.951,
"2009": 71.049,
"2010": 67.195,
"2011": 69.463,
"2012": 61.242,
"2013": 71.707,
"2014": 54.634 
} 
],
"Detroit": [
 {
 "2001": 55.756,
"2002": 58.585,
"2003": 63.317,
"2004": 68.927,
"2005": 67.585,
"2006": 75.317,
"2007": 59.756,
"2008": 77.561,
"2009": 62.244,
"2010": 46.073,
"2011": 53.341,
"2012": 49.727,
"2013": 56.488,
"2014": 55.561 
} 
],
"Golden State": [
 {
 "2001": 38.049,
"2002": 48.878,
"2003": 59.122,
"2004": 65.244,
"2005": 49.341,
"2006": 57.878,
"2007": 67.073,
"2008":  58.61,
"2009": 58.122,
"2010": 43.659,
"2011": 56.805,
"2012": 49.606,
"2013": 63.341,
"2014": 64.878 
} 
],
"Houston": [
 {
 "2001": 58.683,
"2002":     46,
"2003": 67.244,
"2004": 67.561,
"2005": 62.463,
"2006": 49.073,
"2007": 75.122,
"2008": 77.707,
"2009": 77.073,
"2010": 63.244,
"2011": 66.024,
"2012": 67.909,
"2013": 66.659,
"2014": 73.829 
} 
],
"Indiana": [
 {
 "2001": 64.585,
"2002":  61.61,
"2003": 74.122,
"2004": 76.683,
"2005": 62.537,
"2006": 62.805,
"2007":  56.61,
"2008": 59.268,
"2009": 66.146,
"2010": 53.439,
"2011": 64.707,
"2012": 63.091,
"2013":  69.22,
"2014":  68.61 
} 
],
"LA Clippers": [
 {
 "2001": 48.732,
"2002": 63.268,
"2003": 46.585,
"2004": 43.707,
"2005": 69.049,
"2006": 58.902,
"2007": 60.951,
"2008": 37.463,
"2009": 35.829,
"2010": 49.634,
"2011":  59.39,
"2012": 72.303,
"2013": 73.756,
"2014": 71.659 
} 
],
"LA Lakers": [
 {
 "2001":  74.61,
"2002": 66.537,
"2003": 71.195,
"2004": 70.902,
"2005": 54.439,
"2006": 63.854,
"2007": 61.195,
"2008": 65.463,
"2009": 79.805,
"2010": 74.293,
"2011": 71.317,
"2012": 72.242,
"2013":  64.22,
"2014": 37.902 
} 
],
"Memphis": [
 {
 "2001":      0,
"2002": 44.512,
"2003": 57.537,
"2004": 60.878,
"2005": 67.049,
"2006": 68.439,
"2007": 41.244,
"2008": 43.854,
"2009": 49.439,
"2010": 62.561,
"2011": 65.195,
"2012": 69.545,
"2013": 67.537,
"2014": 57.951 
} 
],
"Miami": [
 {
 "2001": 64.512,
"2002": 52.268,
"2003": 51.195,
"2004": 67.488,
"2005": 74.098,
"2006": 61.098,
"2007": 60.707,
"2008": 38.683,
"2009": 54.854,
"2010": 59.049,
"2011": 71.512,
"2012":     70,
"2013": 71.902,
"2014": 65.488 
} 
],
"Milwaukee": [
 {
 "2001": 69.976,
"2002": 58.927,
"2003": 58.732,
"2004": 58.854,
"2005": 53.049,
"2006":     52,
"2007": 53.951,
"2008": 49.707,
"2009": 58.634,
"2010": 62.878,
"2011": 62.098,
"2012": 51.182,
"2013": 51.195,
"2014": 35.171 
} 
],
"Minnesota": [
 {
 "2001": 69.537,
"2002": 75.854,
"2003": 72.268,
"2004": 73.122,
"2005": 57.732,
"2006": 66.902,
"2007": 48.244,
"2008": 47.707,
"2009": 36.512,
"2010": 34.634,
"2011": 42.415,
"2012": 44.394,
"2013": 56.171,
"2014": 63.488 
} 
],
"New Jersey": [
 {
 "2001": 50.146,
"2002":  75.22,
"2003": 75.878,
"2004": 71.537,
"2005": 60.244,
"2006": 66.122,
"2007": 61.024,
"2008": 48.366,
"2009": 46.463,
"2010": 34.317,
"2011": 42.488,
"2012":  39.97,
"2013":      0,
"2014":      0 
} 
],
"New Orleans": [
 {
 "2001":      0,
"2002":      0,
"2003": 70.537,
"2004":  63.22,
"2005": 36.512,
"2006":      0,
"2007":      0,
"2008": 66.122,
"2009": 64.756,
"2010": 51.195,
"2011": 60.366,
"2012": 51.879,
"2013": 50.146,
"2014": 60.463 
} 
],
"New Orleans/Oklahoma City": [
 {
 "2001":      0,
"2002":      0,
"2003":      0,
"2004":      0,
"2005":      0,
"2006": 60.976,
"2007": 53.512,
"2008":      0,
"2009":      0,
"2010":      0,
"2011":      0,
"2012":      0,
"2013":      0,
"2014":      0 
} 
],
"New York": [
 {
 "2001": 67.902,
"2002": 56.195,
"2003": 56.707,
"2004":  54.61,
"2005":  59.78,
"2006": 38.317,
"2007": 44.122,
"2008": 42.732,
"2009": 52.171,
"2010": 53.463,
"2011": 58.439,
"2012": 65.273,
"2013": 70.927,
"2014": 54.805 
} 
],
"Oklahoma City": [
 {
 "2001":      0,
"2002":      0,
"2003":      0,
"2004":      0,
"2005":      0,
"2006":      0,
"2007":      0,
"2008":      0,
"2009":     47,
"2010": 69.902,
"2011": 69.707,
"2012": 72.545,
"2013": 78.902,
"2014": 71.561 
} 
],
"Orlando": [
 {
 "2001": 58.878,
"2002": 68.268,
"2003": 65.463,
"2004": 42.732,
"2005": 58.244,
"2006": 64.195,
"2007": 63.341,
"2008": 70.122,
"2009": 73.561,
"2010": 73.732,
"2011": 64.756,
"2012": 68.485,
"2013": 36.512,
"2014": 47.634 
} 
],
"Philadelphia": [
 {
 "2001": 69.683,
"2002": 57.561,
"2003": 63.146,
"2004": 46.829,
"2005":  63.78,
"2006": 56.098,
"2007": 55.561,
"2008":  55.39,
"2009": 62.171,
"2010":     48,
"2011": 63.805,
"2012": 63.545,
"2013":  52.61,
"2014": 29.244 
} 
],
"Phoenix": [
 {
 "2001":     62,
"2002": 55.512,
"2003": 58.195,
"2004":  49.61,
"2005": 74.659,
"2006": 75.463,
"2007": 76.098,
"2008": 70.561,
"2009": 66.756,
"2010": 71.488,
"2011": 51.951,
"2012": 58.303,
"2013":  44.39,
"2014": 66.317 
} 
],
"Portland": [
 {
 "2001":  68.61,
"2002": 68.805,
"2003": 70.171,
"2004":     55,
"2005": 47.024,
"2006":  41.39,
"2007": 45.024,
"2008": 61.829,
"2009": 69.244,
"2010": 64.512,
"2011": 63.171,
"2012": 61.121,
"2013": 47.244,
"2014": 66.634 
} 
],
"Sacramento": [
 {
 "2001": 72.878,
"2002": 84.122,
"2003": 77.976,
"2004": 74.683,
"2005": 69.488,
"2006": 63.439,
"2007": 62.073,
"2008": 58.415,
"2009": 46.268,
"2010": 51.951,
"2011": 46.122,
"2012": 39.879,
"2013": 49.732,
"2014": 49.634 
} 
],
"San Antonio": [
 {
 "2001": 82.634,
"2002": 79.439,
"2003": 77.317,
"2004": 83.049,
"2005":  85.22,
"2006": 69.756,
"2007": 73.439,
"2008": 71.325,
"2009":  65.55,
"2010": 73.146,
"2011": 78.659,
"2012": 75.121,
"2013": 77.366,
"2014":   74.4 
} 
],
"Seattle": [
 {
 "2001": 62.732,
"2002": 67.171,
"2003": 63.225,
"2004": 53.073,
"2005": 60.829,
"2006": 55.024,
"2007": 50.634,
"2008": 38.244,
"2009":      0,
"2010":      0,
"2011":      0,
"2012":      0,
"2013":      0,
"2014":      0 
} 
],
"Toronto": [
 {
 "2001":     59,
"2002": 59.634,
"2003": 45.146,
"2004": 47.244,
"2005": 53.525,
"2006": 43.707,
"2007": 68.098,
"2008": 60.634,
"2009": 55.659,
"2010": 54.293,
"2011": 46.024,
"2012": 54.606,
"2013": 63.175,
"2014": 62.805 
} 
],
"Utah": [
 {
 "2001": 66.537,
"2002": 64.525,
"2003": 67.244,
"2004": 60.537,
"2005": 51.098,
"2006":  49.35,
"2007": 63.075,
"2008": 80.829,
"2009": 73.732,
"2010": 71.439,
"2011":  58.25,
"2012": 65.697,
"2013": 66.561,
"2014": 55.756 
} 
],
"Vancouver": [
 {
 "2001": 44.293,
"2002":      0,
"2003":      0,
"2004":      0,
"2005":      0,
"2006":      0,
"2007":      0,
"2008":      0,
"2009":      0,
"2010":      0,
"2011":      0,
"2012":      0,
"2013":      0,
"2014":      0 
} 
],
"Washington": [
 {
 "2001": 39.375,
"2002": 60.024,
"2003": 63.073,
"2004":  51.85,
"2005": 65.024,
"2006": 66.902,
"2007": 61.902,
"2008": 62.756,
"2009": 42.805,
"2010": 43.225,
"2011": 47.561,
"2012": 43.531,
"2013": 59.732,
"2014": 60.268 
} 
] 
};


var dataset = [];
for (var key in data) {
  if (data.hasOwnProperty(key)) {
    tmp = {};
    tmp['name'] = key;
    tmp['diff'] = [];
    //tmp['diff_abs'] = [];
    for(var subkey in data[key][0]) {
      tmp['diff'].push([subkey,
                        data[key][0][subkey].toFixed(1)
                        ]);
      //tmp['diff'].push([subkey, data[key][0][subkey].toFixed(1)]);
    }
    dataset.push(tmp);
  }
}

function truncate(str, maxLength, suffix) {
  if(str.length > maxLength) {
    str = str.substring(0, maxLength + 1); 
    str = str.substring(0, Math.min(str.length, str.lastIndexOf(" ")));
    str = str + suffix;
  }
  return str;
}

var margin = {top: 20, right: 200, bottom: 0, left: 20},
  width = 650,
  height = 650;

var start_year = 2001,
  end_year = 2014;

var c = d3.scale.category20c();

var x = d3.scale.linear()
  .range([0, width]);

var xAxis = d3.svg.axis()
  .scale(x)
  .orient("top");

var formatYears = d3.format("0000");
xAxis.tickFormat(formatYears);

var svg = d3.select("#home_lead_prop").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .style("margin-left", margin.left + "px")
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

x.domain([start_year, end_year]);
var xScale = d3.scale.linear()
  .domain([start_year, end_year])
  .range([0, width]);

  svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + 0 + ")")
    .call(xAxis);

  for (var j = 0; j < dataset.length; j++) {
    var g = svg.append("g").attr("class","journal");

    var circles = g.selectAll("circle")
      .data(dataset[j]['diff'])
      .enter()
      .append("circle");

    var text = g.selectAll("text")
      .data(dataset[j]['diff'])
      .enter()
      .append("text");

    var rScale = d3.scale.linear()
      .domain([0, d3.max(dataset[j]['diff'], function(d) { return d[1]; })])
      .range([0, 100]);

    circles
      .attr("cx", function(d, i) { return xScale(d[0]); })
      .attr("cy", j*20+20)
      .attr("r", function(d) { return rScale(d[1]) / 11; })
      .style("fill", function(d) { return c(j); });

    text
      .attr("y", j*20+25)
      .attr("x",function(d, i) { return xScale(d[0])-5; })
      .attr("class","value")
      .text(function(d){ return d[1]; })
      .style("fill", function(d) { return c(j); })
      .style("display","none");

    g.append("text")
      .attr("y", j*20+25)
      .attr("x",width+20)
      .attr("class","label")
      .text(truncate(dataset[j]['name'],30,"..."))
      .style("fill", function(d) { return c(j); })
      .on("mouseover", mouseover)
      .on("mouseout", mouseout);
  };

  function mouseover(p) {
    var g = d3.select(this).node().parentNode;
    d3.select(g).selectAll("circle").style("display","none");
    d3.select(g).selectAll("text.value").style("display","block");
  }

  function mouseout(p) {
    var g = d3.select(this).node().parentNode;
    d3.select(g).selectAll("circle").style("display","block");
    d3.select(g).selectAll("text.value").style("display","none");
  }

</script>
